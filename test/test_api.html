<!DOCTYPE HTML>
<HTML>
	<HEAD>
		<title>VideoJS Annotated Comments Test Page</title>
		<link href="video.js/dist/video-js.css" rel="stylesheet">
		<link href="assets/videojs_skin.css" rel="stylesheet">
		<link href="assets/page.css" rel="stylesheet">
		<link href="css/annotations.css" rel="stylesheet">
		<script>
			function guid() {
		      function s4() {
		        return Math.floor((1 + Math.random()) * 0x10000)
		          .toString(16)
		          .substring(1);
		      }
		      return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
		        s4() + '-' + s4() + s4() + s4();
		    }
			// W3C Web Annotation Data Model format
			var ann2Id = "ann-2";
			var annotations = [
				{
					"@context": "http://www.w3.org/ns/anno.jsonld",
					"type": "Annotation",
					"id": 1,
					"motivation": "commenting",
					"body": {
						"type": "TextualBody",
						"value": "Is the \"Stories API\" the only API we want to highlight here? It makes the system feel a little limited, even though we have robust functionality and multiple APIs",
						"format": "text/plain"
					},
					"target": {
						"type": "SpecificResource",
						"source": "contently-platform-overview.mp4",
						"selector": {
							"type": "FragmentSelector",
							"conformsTo": "http://www.w3.org/TR/media-frags/",
							"value": "t=55&xywh=percent:23.47,9.88,37.36,34.32"
						}
					},
					"creator": { "type": "Person", "name": "Jack Pope", "id": "1" },
					"created": "2017-03-28T19:17:32.238Z"
				},
				{
					"@context": "http://www.w3.org/ns/anno.jsonld",
					"type": "Annotation",
					"id": ann2Id,
					"motivation": "commenting",
					"body": {
						"type": "TextualBody",
						"value": "Can we replace this logo with Microsoft?",
						"format": "text/plain"
					},
					"target": {
						"type": "SpecificResource",
						"source": "contently-platform-overview.mp4",
						"selector": {
							"type": "FragmentSelector",
							"conformsTo": "http://www.w3.org/TR/media-frags/",
							"value": "t=0,65&xywh=percent:0.97,65.19,35.28,32.09"
						}
					},
					"creator": { "type": "Person", "name": "Evan Carothers", "id": "2" },
					"created": "2017-03-28T19:18:25.485Z"
				},
				{
					"@context": "http://www.w3.org/ns/anno.jsonld",
					"type": "Annotation",
					"id": guid(),
					"motivation": "replying",
					"body": {
						"type": "TextualBody",
						"value": "Great idea Evan, that's a SUPER recognizable brand!\n\nAny other major company brands we are missing in this shot?",
						"format": "text/plain"
					},
					"target": ann2Id,
					"creator": { "type": "Person", "name": "Jack Pope", "id": "1" },
					"created": "2017-03-29T00:18:25.485Z"
				},
				{
					"@context": "http://www.w3.org/ns/anno.jsonld",
					"type": "Annotation",
					"id": 3,
					"motivation": "commenting",
					"body": {
						"type": "TextualBody",
						"value": "Can we have a music change for this final section that transitions towards the final frame? Some sweet heavy rock 80s ballad?",
						"format": "text/plain"
					},
					"target": {
						"type": "SpecificResource",
						"source": "contently-platform-overview.mp4",
						"selector": {
							"type": "FragmentSelector",
							"conformsTo": "http://www.w3.org/TR/media-frags/",
							"value": "t=100,130"
						}
					},
					"creator": { "type": "Person", "name": "Jack Pope", "id": "1" },
					"created": "2017-03-28T19:21:41.351Z"
				},
				{
					"@context": "http://www.w3.org/ns/anno.jsonld",
					"type": "Annotation",
					"id": 4,
					"motivation": "commenting",
					"body": {
						"type": "TextualBody",
						"value": "The music is a little loud through this section and distracts from the content and narration a bit - can we tone 'er down a couple nocks here?",
						"format": "text/plain"
					},
					"target": {
						"type": "SpecificResource",
						"source": "contently-platform-overview.mp4",
						"selector": {
							"type": "FragmentSelector",
							"conformsTo": "http://www.w3.org/TR/media-frags/",
							"value": "t=21,61"
						}
					},
					"creator": { "type": "Person", "name": "Evan Carothers", "id": "2" },
					"created": "2017-03-28T19:21:41.351Z"
				},
				{
					"@context": "http://www.w3.org/ns/anno.jsonld",
					"type": "Annotation",
					"id": 5,
					"motivation": "commenting",
					"body": {
						"type": "TextualBody",
						"value": "Testing moment vs ranged comment at same start time - activation bug",
						"format": "text/plain"
					},
					"target": {
						"type": "SpecificResource",
						"source": "contently-platform-overview.mp4",
						"selector": {
							"type": "FragmentSelector",
							"conformsTo": "http://www.w3.org/TR/media-frags/",
							"value": "t=21"
						}
					},
					"creator": { "type": "Person", "name": "Evan Carothers", "id": "2" },
					"created": "2017-03-28T19:21:41.351Z"
				}
			];
		</script>

	</HEAD>
	<BODY>
		<video id="the_video" class="video-js" controls preload="auto" width="720" height="405" poster="MY_VIDEO_POSTER.jpg" data-setup="{}">
		    <source src="contently-platform-overview.mp4" type='video/mp4'>
		    <p class="vjs-no-js">
		     	To view this video please enable JavaScript, and consider upgrading to a web browser that
		     	<a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
		    </p>
		</video>

        <div id="test-control-panel">
            <div class="control-section">
                <p class="event-type"><strong>SEND:</strong> Open Annotation Event</p>
                <label>Annotation ID</label>
                <input id="annotation-id-input">
                <button id="fire-open-annotation">FIRE</button>
            </div>

			<div class="control-section">
				<p class="event-type"><strong>SEND:</strong> Close Active Annotation Event</p>
				<button id="fire-close-active-annotation">FIRE</button>
			</div>

			<div class="control-section">
				<p class="event-type"><strong>RECEIVE:</strong> Annotation Opened Event</p>
				<p>Id opened: <span id="annotation-opened-id"></span></p>
			</div>

			<div class="control-section">
				<p class="event-type"><strong>SEND:</strong> Adding Annotation Event</p>
				<button id="fire-adding-annotation">FIRE</button>
			</div>

			<div class="control-section">
				<p class="event-type"><strong>SEND:</strong> Cancel Adding Annotation Event</p>
				<button id="fire-cancel-adding-annotation">FIRE</button>
			</div>

			<div class="control-section">
				<p class="event-type"><strong>SEND:</strong> Toggle Annotation Mode</p>
				<button id="fire-toggle-annotation-mode">FIRE</button>
			</div>

			<div class="control-section hidden" id="new-annotation-form">
				<p class="event-type"><strong>SEND:</strong> New Annotation Event</p>
				<label>Comment body</label>
				<textarea id="new-annotation-comment-body"></textarea>
				<input type="hidden" id="new-annotation-range-start">
				<input type="hidden" id="new-annotation-range-end">
				<input type="hidden" id="new-annotation-shape-x1">
				<input type="hidden" id="new-annotation-shape-x2">
				<input type="hidden" id="new-annotation-shape-y1">
				<input type="hidden" id="new-annotation-shape-y2">
				<button id="fire-new-annotation">Save</button>
			</div>

			<div class="control-section" id="new-comment-form">
				<p class="event-type"><strong>SEND:</strong> New Comment Event</p>
				<label>Annotation ID</label>
				<input id="new-comment-annotation-id">
				<label>Comment Body</label>
				<textarea id="new-comment-body"></textarea>
				<button id="fire-new-comment">Save</button>
			</div>

			<div class="control-section" id="destroy-comment-form">
				<p class="event-type"><strong>SEND:</strong> Destroy Comment Event</p>
				<label>Comment ID</label>
				<input id="destroy-comment-id">
				<button id="fire-destroy-comment">FIRE</button>
			</div>
        </div>

		<script src="video.js/dist/video.min.js"></script>
		<script src="videojs-annotation.js"></script>
		<script>
			window.VAC_DEBUG = true;
			var player = videojs('the_video');
			window.plugin = player.annotationComments({
				annotationsObjects: annotations,
				bindArrowKeys: true,
				meta: {
					user_id: 2,
					user_name: "Evan Carothers"
				},
				onStateChanged: function(data){ console.log(data); },
				internalCommenting: false,
				showControls: false,
				showMarkerTooltips: false,
				startInAnnotationMode: true
			});

			document.getElementById("fire-open-annotation").addEventListener("click", function() {
				var id = document.getElementById("annotation-id-input").value;
				plugin.fire("openAnnotation", {id: id});
			});

			document.getElementById("fire-close-active-annotation").addEventListener("click", function() {
				plugin.fire("closeActiveAnnotation", {});
			});

			document.getElementById("fire-adding-annotation").addEventListener("click", function() {
				plugin.fire("addingAnnotation");
			});

			document.getElementById("fire-cancel-adding-annotation").addEventListener("click", function() {
				plugin.fire("cancelAddingAnnotation");
				document.getElementById("new-annotation-form").classList.add("hidden");
			});

			document.getElementById("fire-toggle-annotation-mode").addEventListener("click", function(){
				plugin.fire("toggleAnnotationMode");
			});

			document.getElementById("fire-new-annotation").addEventListener("click", function() {
				var annotation = {
					id: 999,
					range: {
						start: document.getElementById("new-annotation-range-start").value,
						end: document.getElementById("new-annotation-range-end").value
					},
					shape: {
						x1: document.getElementById("new-annotation-shape-x1").value,
						x2: document.getElementById("new-annotation-shape-x2").value,
						y1: document.getElementById("new-annotation-shape-y1").value,
						y2: document.getElementById("new-annotation-shape-y2").value,
					},
					commentStr: document.getElementById("new-annotation-comment-body").value
				};
				plugin.fire("newAnnotation", annotation);
			});

			document.getElementById("fire-new-comment").addEventListener("click", function() {
				var data = {
					annotationId: document.getElementById("new-comment-annotation-id").value,
					body: document.getElementById("new-comment-body").value
				};
				plugin.fire("newComment", data);
			});

			document.getElementById("fire-destroy-comment").addEventListener("click", function() {
				var id = document.getElementById("destroy-comment-id").value;
				plugin.fire("destroyComment", {id: id});
			});

			plugin.registerListener("annotationOpened", function(event) {
				var id = event.detail.annotation.id;
				document.getElementById("annotation-opened-id").textContent = id;
			});

			plugin.registerListener("addingAnnotationDataChanged", function(event) {
				console.log(event.detail);
			});

			plugin.registerListener("enteredAddingAnnotation", function(event) {
				var range = event.detail.range;
				console.log("Starting add annotation process");
				document.getElementById("new-annotation-form").classList.remove("hidden");
				document.getElementById("new-annotation-range-start").value = range.start;
			});

			plugin.registerListener("addingAnnotationDataChanged", function(event) {
				if(event.detail.shape) {
					document.getElementById("new-annotation-shape-x1").value = event.detail.shape.x1;
					document.getElementById("new-annotation-shape-x2").value = event.detail.shape.x2;
					document.getElementById("new-annotation-shape-y1").value = event.detail.shape.y1;
					document.getElementById("new-annotation-shape-y2").value = event.detail.shape.y2;
				} else {
					document.getElementById("new-annotation-range-start").value = event.detail.range.start;
					document.getElementById("new-annotation-range-end").value = event.detail.range.end;
				}
			});
		</script>
	</BODY>
</HTML>
